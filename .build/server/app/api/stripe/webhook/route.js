"use strict";(()=>{var e={};e.id=757,e.ids=[757],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},1764:e=>{e.exports=require("util")},1791:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>E,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{POST:()=>l,dynamic:()=>u});var s=t(9182),a=t(2007),n=t(6719),i=t(3442),p=t(5729),d=t(3178);let u="force-dynamic",c=process.env.STRIPE_WEBHOOK_SECRET;async function l(e){let r;if(!c)return console.error("STRIPE_WEBHOOK_SECRET is not set"),i.NextResponse.json({error:"Webhook secret not configured"},{status:500});let t=await e.text(),o=e.headers.get("stripe-signature");if(!o)return i.NextResponse.json({error:"No signature provided"},{status:400});try{r=p.Ag.webhooks.constructEvent(t,o,c)}catch(e){return console.error("Webhook signature verification failed:",e),i.NextResponse.json({error:"Invalid signature"},{status:400})}try{switch(r.type){case"payment_intent.succeeded":let e=r.data.object,t=e.metadata?.orderId;t&&(await d._.order.update({where:{id:t},data:{status:"PROCESSING",stripePaymentId:e.id}}),console.log(`Order ${t} payment succeeded`));break;case"payment_intent.payment_failed":let o=r.data.object,s=o.metadata?.orderId;s&&(await d._.order.update({where:{id:s},data:{status:"CANCELLED"}}),console.log(`Order ${s} payment failed`));break;default:console.log(`Unhandled event type: ${r.type}`)}return i.NextResponse.json({received:!0})}catch(e){return console.error("Error processing webhook:",e),i.NextResponse.json({error:"Webhook processing failed"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"/home/ubuntu/dischound_store/nextjs_space/app/api/stripe/webhook/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:E,staticGenerationAsyncStorage:m,serverHooks:v}=h,x="/api/stripe/webhook/route";function g(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},3178:(e,r,t)=>{t.d(r,{_:()=>s});var o=t(3524);let s=globalThis.prisma??new o.PrismaClient},5729:(e,r,t)=>{t.d(r,{Ag:()=>s,bZ:()=>a});var o=t(9280);if(!process.env.STRIPE_SECRET_KEY)throw Error("STRIPE_SECRET_KEY is not set in environment variables");let s=new o.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-10-29.clover"}),a=e=>Math.round(100*e)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[372,609,280],()=>t(1791));module.exports=o})();